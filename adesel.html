<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Envanter Takibi</title>
</head>
<body>
    <h2>√úr√ºn Envanteri</h2>

    <!-- Yeni √úr√ºn Ekleme Formu -->
    <h3>Yeni √úr√ºn Ekle</h3>
    <label>√úr√ºn Kodu: <input type="text" id="newCode"></label>
    <label>√úr√ºn Adƒ±: <input type="text" id="newName"></label>
    <label>Koli ƒ∞√ßi: <input type="number" id="newPack"></label>
    <label>Envanter: <input type="number" id="newInventory"></label>
    <button onclick="addProduct()">√úr√ºn Ekle</button>

    <div id="inventory-container">Y√ºkleniyor...</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, get, update, set, remove } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // Firebase yapƒ±landƒ±rmasƒ±
        const firebaseConfig = {
            apiKey: "AIzaSyBln6yEItRD6iYCq3l6WLqre51Jp1MfPfw",
            authDomain: "adesel.firebaseapp.com",
            databaseURL: "https://adesel-default-rtdb.firebaseio.com",
            projectId: "adesel",
            storageBucket: "adesel.firebasestorage.app",
            messagingSenderId: "523757015370",
            appId: "1:523757015370:web:e213ae1727160ed73bb1b3",
            measurementId: "G-1PZPGXK48F"
        };

        // Firebase ba≈ülatma
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // √úr√ºnleri getir ve listele
        function fetchProducts() {
            const productsRef = ref(database, 'products');
            get(productsRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const products = snapshot.val();
                    let html = `<table border="1">
                        <tr>
                            <th>√úr√ºn Kodu</th>
                            <th>√úr√ºn Adƒ±</th>
                            <th>Koli ƒ∞√ßi</th>
                            <th>Genel Envanter</th>`;
                    
                    for (let i = 1; i <= 31; i++) {
                        html += `<th>G√ºn ${i}</th>`;
                    }
                    html += `<th>G√ºncelle</th><th>Sil</th></tr>`;

                    for (const code in products) {
                        const product = products[code];
                        html += `<tr>
                            <td>${code}</td>
                            <td><input type="text" id="name-${code}" value="${product.name || ''}"></td>
                            <td><input type="number" id="pack-${code}" value="${product.pack || 0}"></td>
                            <td><input type="number" id="inventory-${code}" value="${product.inventory || 0}"></td>`;

                        for (let i = 1; i <= 31; i++) {
                            let dayValue = product.dailyInventory?.[i] || 0;
                            html += `<td><input type="number" id="day-${code}-${i}" value="${dayValue}"></td>`;
                        }

                        html += `<td><button onclick="updateProduct('${code}')">G√ºncelle</button></td>
                                 <td><button onclick="deleteProduct('${code}')">Sil</button></td></tr>`;
                    }

                    html += `</table>`;
                    document.getElementById('inventory-container').innerHTML = html;
                } else {
                    document.getElementById('inventory-container').innerHTML = "Veri bulunamadƒ±.";
                }
            }).catch((error) => {
                console.error("Veri alma hatasƒ± ‚ùå:", error);
            });
        }

        // Firebase'e √ºr√ºn g√ºncelleme fonksiyonu
        window.updateProduct = function(code) {
            const name = document.getElementById(`name-${code}`).value;
            const pack = parseInt(document.getElementById(`pack-${code}`).value);
            const inventory = parseInt(document.getElementById(`inventory-${code}`).value);

            let inventoryData = {};
            for (let i = 1; i <= 31; i++) {
                let dayValue = parseInt(document.getElementById(`day-${code}-${i}`).value) || 0;
                inventoryData[i] = dayValue;
            }

            const productRef = ref(database, 'products/' + code);
            update(productRef, {
                name: name,
                pack: pack,
                inventory: inventory,
                dailyInventory: inventoryData
            }).then(() => {
                alert("√úr√ºn ba≈üarƒ±yla g√ºncellendi! ‚úÖ");
            }).catch((error) => {
                console.error("Firebase G√ºncelleme Hatasƒ± ‚ùå:", error);
            });
        };

        // Firebase'e yeni √ºr√ºn ekleme fonksiyonu
        window.addProduct = function() {
            const newCode = document.getElementById("newCode").value.trim();
            const newName = document.getElementById("newName").value.trim();
            const newPack = parseInt(document.getElementById("newPack").value);
            const newInventory = parseInt(document.getElementById("newInventory").value);

            if (!newCode || !newName || isNaN(newPack) || isNaN(newInventory)) {
                alert("L√ºtfen t√ºm alanlarƒ± doƒüru doldurun! ‚ö†Ô∏è");
                return;
            }

            let emptyDailyInventory = {};
            for (let i = 1; i <= 31; i++) {
                emptyDailyInventory[i] = 0;
            }

            const productRef = ref(database, 'products/' + newCode);
            set(productRef, {
                name: newName,
                pack: newPack,
                inventory: newInventory,
                dailyInventory: emptyDailyInventory
            }).then(() => {
                alert("√úr√ºn ba≈üarƒ±yla eklendi! ‚úÖ");
                fetchProducts(); // Sayfayƒ± yenilemeden listeyi g√ºncelle
            }).catch((error) => {
                console.error("Firebase √úr√ºn Ekleme Hatasƒ± ‚ùå:", error);
            });
        };

        // Firebase'den √ºr√ºn silme fonksiyonu
        window.deleteProduct = function(code) {
            if (confirm("Bu √ºr√ºn√º silmek istediƒüinize emin misiniz? ‚ö†Ô∏è")) {
                const productRef = ref(database, 'products/' + code);
                remove(productRef).then(() => {
                    alert("√úr√ºn ba≈üarƒ±yla silindi! üóëÔ∏è");
                    fetchProducts(); // Sayfayƒ± yenilemeden listeyi g√ºncelle
                }).catch((error) => {
                    console.error("Firebase √úr√ºn Silme Hatasƒ± ‚ùå:", error);
                });
            }
        };

        // Sayfa a√ßƒ±ldƒ±ƒüƒ±nda √ºr√ºnleri getir
        fetchProducts();
    </script>
</body>
</html>
